# Android WebView + Rust(JNI) 播放器/打包工具：增强版提示词

我正在开发一个基于 Android WebView + Rust JNI 的音频播放器和加密封装工具。该工具支持：
1. 将音频文件打包为 `.furry` 格式
2. 解包 `.furry` 文件
3. 导出文件到系统
4. 播放音频（支持直接播放音频文件或自动解包 `.furry` 文件后播放）

**当前问题：**
- 播放器功能不完整，缺少基本的播放控制/队列能力
- 前端日志和事件提示对用户不友好（过于技术化、刷屏、顺序难读）
- 缺少完整的播放体验（播放列表、队列管理、错误恢复等）

**改造目标：**
请基于现有工程（重点：`apps/furry_android_app/app/src/main/java/com/furry/player/MainActivity.kt` 与 `apps/furry_android_app/app/src/main/assets/index.html`），提出一个清晰可执行的改造方案，包含：

1. **用户友好的状态提示系统**
   - 将 native->web 事件转换为用户可理解的状态和错误提示
   - 支持可选的调试模式显示技术细节（事件名/原始 JSON/耗时等）
   - 区分用户级别消息和开发者级别消息（避免把内部事件暴露给普通用户）

2. **完整的播放器体验**
   - 播放列表/队列管理（入队、移除、清空、排序）
   - 上一首/下一首/循环模式（单曲循环/列表循环/随机）
   - 可拖拽的进度条（seek），并在拖拽期间避免状态抖动
   - 播放状态实时同步（preparing/playing/paused/stopped + 当前曲目 + 时长/进度）
   - 完善的错误处理和恢复机制（解包失败、播放器不支持格式、文件缺失、权限失败等）

3. **安全性保障**
   - 确保 WebView 只加载本地 assets 资源
   - 防止外部链接滥用 JavaScript bridge（禁止外链页面拿到 bridge）
   - 验证所有文件操作的安全性（路径、文件名、导出行为、私有目录隔离等）

4. **接口规范**
   - 提供 Android 侧需要新增/修改的方法清单（方法名、参数、返回值、线程模型）
   - 提供前端侧需要新增/修改的事件与函数清单（事件名、字段结构、触发时机）
   - 保持向后兼容，说明旧接口的弃用策略（如果有）

**交付要求：**
请提供详细的任务拆解（面向可直接执行），每个任务包含：
- 具体实现步骤
- 明确验收标准（可测试/可复现）
- 涉及的文件与代码位置
- 预估工作量
- 任务间依赖关系与建议实施顺序

任务拆解应足够详细，可以直接交给开发人员或 AI 助手按步骤落地实现。

